---
title: 'Analysis Report: Motivated Responses to a Masculinity Threat
  in a German Cultural Context'
output_dir: ../
output:
  pdf_document:
    df_print: default
    latex_engine: xelatex
    keep_tex: true
    highlight: tango
    includes:
      in_header: tex/header.tex
  html_document: default
  word_document: default
date: "`r format(Sys.Date(), '%Y-%m-%d')`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.align = "center",
  fig.pos = "!H",
  fig.width = 6,
  fig.height = 4
)
```

```{r message=FALSE, warning=FALSE, include=FALSE}
# R version 4.5.2
library(dplyr)
library(here)
library(ggplot2)
library(stringr)
library(R.utils)
library(rlang)
library(tidyr)
library(jtools)
library(ggpubr)
library(lavaan)
library(corrplot)
library(psych)
library(car)
library(knitr)
library(kableExtra)
library(semTools)
library(boot)
library(mirt)
library(gridExtra)
library(DHARMa)
```

```{r message=FALSE, warning=FALSE, include=FALSE}
source(here("analysis/R", "word-catalog.R"))
source(here("analysis/R", "items-and-labels.R"))
source(here("analysis/R", "data-preprocessing.R"))
source(here("analysis/R", "visualization.R"))
source(here("analysis/R", "utils.R"))
source(here("analysis/R", "simulation.R"))
source(here("analysis/R", "inference-statistics.R"))
source(here("analysis/R", "factor-analysis.R"))
source(here("analysis/R", "export-helpers.R"))
```

```{r}
df <- read.csv(here("data", "fragile_masculinity_motivation_anonymized.csv"))
df <- preprocessData(df, all_items)
```

# 1. Study Inclusion Criteria

## 1.1 Debrief Consent
Participants that withdrew their consent after the debrief are excluded
```{r}
df <- exclude_participants(
  df,
  DEBRIEFCONSENT == "Y",
  vars = "DEBRIEFCONSENT",
  description = "Debrief consent"
)
```

## 1.2 Demographic criteria
Participants have to be older than 18 years, self-identify as male and native level German skills
```{r}
df <- exclude_participants(df, AGE >= 18, vars = "AGE", description = "Age")
df <- exclude_participants(df, SEX == "AO01", vars = "SEX", description = "Gender")
df <- exclude_participants(df, GER %in% c("AO04", "AO05"), vars = "GER", description = "German skills")
```

## 1.3 Suspicion
Participants may not indicate a strong suspicion about the study (coded in column SUSPICIONEXCLUSION, free text are excluded in anonymous data set)
```{r}
df <- exclude_participants(
  df,
  SUSPICIONEXCLUSION == FALSE,
  vars = "SUSPICIONEXCLUSION",
  description = "Suspicion"
)
```

## 1.4 WFCT comprehension
Participants should complete more than 50% of word fragments with existing words
```{r}
df <- exclude_participants(
  df,
  validWordCompletionScore >= 0.5,
  vars = "validWordCompletionScore",
  description = "WFCT comprehension"
)
```

## 1.5 Responses to Motivation for Masculine Behaviour
Participants should respond to at least one item of each MMB scale
```{r}
df <- exclude_participants(
  df,
  rowSums(!is.na(df[mmb_pressured_items])) >= 1,
  vars = mmb_pressured_items,
  description = "Missing all Pressured items"
)

df <- exclude_participants(
  df,
  rowSums(!is.na(df[mmb_autonomous_items])) >= 1,
  vars = mmb_autonomous_items,
  description = "Missing all Autonomous items"
)
```

# 2. Demographics

## 2.2 Age
```{r}
summary_mean_sd(df, "AGE")
```

```{r}
plotHist("AGE", c(0, 70), condition = NULL, binwidth = 1)
```

## 2.3 Educational Degree

```{r}
freq_table(df, EDU_label)
```

```{r}
plotBarHorizontal("EDU_label") +
  labs(
    x = NULL,
    y = "Anzahl"
  )
```

```{r}
freq_table(df, EDUPUPIL_label)
```

## 2.4 Occupational Degree

```{r}
freq_table(df, OCC_label)
```

```{r}
plotBarHorizontal("OCC_label") +
  labs(
    x = NULL,
    y = "Anzahl"
  )
```

# 3. Experimental Manipulation Check

## 3.1 Conditions
```{r}
printNumberOfParticipants(df, "threatCondition")
```

## 3.2 Gender Knowledge Feedback
[GKFEEDBACK] Welche Rückmeldung haben Sie im Verlauf der Studie zu Ihrem Wissen in geschlechtsspezifischen Themen erhalten?
Scale 1 to 10
```{r}
summary_gkfeedback <- summary_mean_sd(df, "GKFEEDBACK", "threatCondition")
summary_gkfeedback
```

```{r}
plotHist("GKFEEDBACK", c(1, 10), "threatCondition")
```

**Interpretation**

- There is a clar split between the two conditions, meaning that participants paid attention to the feedback
on the GenderKnoledge task and that the feedback was comprehensible

## 3.3 Self evaluation of Gender Knowledge
*Objectives:*

- Testing if self evaluated gender knowledge is significantly less in the threat Condition

*Methodology:*

- Visualization & Descriptives
- Prerequisites for inference statistics (homogeneity, normal distribution)
- Inference Statistics (t-test)

### 3.3.1 Visualization & Descriptives

```{r}
plotHist("GKSELF", c(1, 10), "threatCondition")
```

[GKSELF] Wie würden Sie Ihr Wissen in geschlechtsspezifischen Themen einschätzen?
```{r}
summary_gkself <- summary_mean_sd(df, "GKSELF", "threatCondition")
summary_gkself
```

**Interpretation**

- The mean of self evalutated gender knowledge is lower in the threat condition, 
than noThreat condition

### 3.3.2 Inference Statistical Comparison

Normality of distribution
```{r}
check_normality_hist(
  df, GKSELF,
  threatCondition
)
```

Homogenity of Variance (Levene Test)
```{r}
check_homogeneity(
  df, GKSELF,
  threatCondition
)
```
p > .05 → equal variances (use Student’s t-test: var.equal = TRUE)

**Interpretation:**

- A visual inspection confirms normally distributed data for both conditions
- The Levene test confirms homogeneity of variance

```{r}
run_ttest(df, GKSELF, threatCondition,
  alternative = "less", var_equal = TRUE 
)
```

**Interpretation:**

- The p-value is highly significant (p < 0.01) showing that the threat condition
had a significant effect on the self evaluation of gender specific knowledge 
(i.e. lower self evaluation)

## 3.4 Valid Word Completions

```{r}
summary_mean_sd(df, "validWordCompletionScore")
```

```{r}
plotBox("validWordCompletionScore")
```

**Interpretation**

- Participants with a score lower than 50% were excluded
- Generally participants were able to complete the WCFT

## 3.5 Motivation for Masculine Behaviour

```{r}
plots <- lapply(MMB_item_codes, function(item) {
  plotHist(item, c(1, 7), condition = NULL, binwidth = 1)
})

do.call(grid.arrange, c(plots, ncol = 3))
```


```{r}
summary_mean_sd(df, MMB_item_codes)
```

## 3.6 Aggressive Cognition

```{r}
plots <- lapply(WFCT_aggression_items, function(item) {
  plotHist(item, c(0, 1), condition = NULL, binwidth = 1)
})

do.call(grid.arrange, c(plots, ncol = 4))
```

```{r}
summary_mean_sd(df, WFCT_aggression_items)
```

## 3.7 Anxious Cognition

```{r}
plots <- lapply(WFCT_anxiety_items, function(item) {
  plotHist(item, c(0, 1), condition = NULL, binwidth = 1)
})

do.call(grid.arrange, c(plots, ncol = 4))
```

```{r}
summary_mean_sd(df, WFCT_anxiety_items)
```

# 4. Test Quality Criteria: Motivation for Masculine Behaviour

*Objectives:*

- Assess the *validity* and *reliability* of the scale Motivation for Masculine
Behaviour (MMB) 
- Compute participant latent trait scores

*Methodology:*

- Visualization & Descriptives
- CFA and EFA to => construct validity
- McDonald's Omega => Reliabiltiy
- Regression scoring => latent trait scores

## 4.1 Construct Validity 

### 4.1.1 Visualization & Descriptives

```{r}
cor_mmb <- psych::polychoric(df[MMB_item_codes])$rho

corrplot(cor_mmb,
  method = "color",
  type = "upper",
  order = "original",
  tl.col = "black",
  tl.srt = 45,
  diag = FALSE
)
```

**Interpretation**

- The correlation plit shows a very clear block for MMB 1-5 items (pressured scale)
- The block for for autonomous items (MMB 6 - 9) is way less clear

```{r}
summary_mean_sd(df, MMB_item_codes)
```

**Interpretation**

- The item scores ranged between 1 and 7
- Most items show a mean in the center of the scale
- Item MMBi7 shows a very high mean (5.27). "Ich bin gerne männlich"  
- Generally, the items do not show bottom or ceiling effects, and there is some variance to the responses

### 4.1.2 Check sampling adequacy for Factory Analysis

```{r}
KMO(cor_mmb)
cortest.bartlett(cor_mmb, n = nrow(df))
```
KMO (Kaiser-Meyer-Olkin) should be > 0.6 (ideally > 0.8)
Bartlett’s test should be significant (p < .05)

**Interpretation**

- The overall KMO is 0.86 showing a good smapling adequacy for factor analysis
- Individual scores of items are good as well, except MMBi7, which has a sufficient, yet lower KMO value (0.72) due to it's ceiling effect
- The Bartlett test is significant as well, showing a sampling adequacy for factor analysis

### 4.1.3 Two-Factor Uncorrelated CFA
Testing the proposed 2 factor structure by Stanaland & Gaither (2021)

- 2 factors
- no covariance between factors
```{r }
model_twof <- "
  # latent variables
  Pressured =~ MMBi1 + MMBi2 + MMBi3 + MMBi4 + MMBi5
  Autonomous =~ MMBi6 + MMBi7 + MMBi8 + MMBi9

  # constrain covariance to 0
  Pressured ~~ 0*Autonomous
"

results_twof <- run_cfa_model(model_twof, df, model_name = "Two-Factor Uncorrelated", show_mi = TRUE)
```

**Interpretation**

- None of the model fit indices is satisfying
- Mod Indices suggest a correlation between latent pressured and autonomous factors

### 4.1.4 Exploratory Factor Analysis

#### Determine the number of latent factors

```{r }
fa.parallel(cor_mmb,
  fm = "ml",
  fa = "fa", n.iter = 100, show.legend = TRUE,
  main = "Parallel Analysis Scree Plot"
)
```
**Interpretation:**

- The "elbow" of the scree plot suggest a two factor model

#### Compute EFA

```{r }
efa_result_twof <- fa(df[MMB_item_codes], nfactors = 2, rotate = "oblimin", fm = "ml")
print(efa_result_twof, cut = 0.3) # only loadings > .30
```


```{r warning=FALSE }
# Create loadings matrix
loadings_matrix <- as.data.frame(efa_result_twof$loadings[1:length(mmb_labels), ])

# Format table
loading_table <- data.frame(
  Item = MMB_item_codes,
  Label = mmb_labels,
  Factor1 = round(loadings_matrix$ML1, 2),
  Factor2 = round(loadings_matrix$ML2, 2)
)

# Hide loadings < .30
loading_table <- loading_table %>%
  mutate(
    Factor1 = ifelse(abs(Factor1) < 0.30, "", as.character(Factor1)),
    Factor2 = ifelse(abs(Factor2) < 0.30, "", as.character(Factor2))
  )

# Render nice APA-style table
loading_table %>%
  kbl(
    caption = "EFA Loadings for MMB Items (2-Factor Solution)",
    align = "lccc",
    booktabs = TRUE
  ) %>%
  kable_styling(
    full_width = FALSE,
    position = "center",
    bootstrap_options = c("striped", "hover", "condensed"),
    latex_options = "hold_position"
  ) %>%
  column_spec(2, width = "10cm") %>%  
  row_spec(0, bold = TRUE, background = "#f2f2f2") %>%
  row_spec(1:nrow(loading_table), background = "white", color = "black")
```

**Interpretation**

- EFA sows a very distinct factor for pressured motivation
- The factor for autonomous motivation is less clear and MMBi9 shows loadings on both factors

### 4.1.5 Two-Factor Correlated CFA

- 2 latent factors, 
- correlation allowed between factors
```{r,  }
model_twof_cor <- "
  # latent variables
  Pressured =~ MMBi1 + MMBi2 + MMBi3 + MMBi4 + MMBi5
  Autonomous =~ MMBi6 + MMBi7 + MMBi8 + MMBi9

  # allow correlation between factors
  Pressured ~~ Autonomous
"

results_twof_cor <- run_cfa_model(model_twof_cor, df, model_name = "Two-Factor Correlated", show_mi = TRUE)
```

Interpretation

- Allowing for a correlation between latent factors creates a better fit but still not sufficient
- Mod indices suggest A correlation between Item MMBi5 and MMBi9, This makes conceptually sense, because they both deal with anti femininity. 

### 4.1.6 Two-Factor Correlated + Residuals CFA

- 2 latent factors
- correlation allowed between factors
- allow correlated residuals
```{r }
model_twof_cor_mod <- "
  # latent variables
  Pressured =~ MMBi1 + MMBi2 + MMBi3 + MMBi4 + MMBi5
  Autonomous =~ MMBi6 + MMBi7 + MMBi8 + MMBi9

  Pressured ~~ Autonomous

  # theory-based correlated residuals
  MMBi3 ~~ MMBi4
  MMBi5 ~~ MMBi9
  MMBi7 ~~ MMBi8
"

results_twof_cor_mod <- run_cfa_model(model_twof_cor_mod, df, model_name = "Two-Factor Correlated Modified", show_mi = TRUE)
```

**Interpretation**

- ...

## 4.2 Reliability

``` {r}
fit_twof_cor_mod <- cfa(model_twof_cor_mod, data = df, std.lv = TRUE)
rel <- reliability(fit_twof_cor_mod)
print(rel)
```

**Interpretation**

- Pressured scale shows an excellent reliability (> .9)
- Autonomous scale shows an acceptable reliability (> .7)
=> reliability is sufficient, so we use the proposed factor structure to 
compute factor scored for autonomous and pressured motivation 

Omega values ≥ .70 (acceptable), ≥ .80 (good).
=> Alpha assumes tau-equivalence (all items same loading), which isn't true here,
so we trust omega more


## 4.3 Latent Trait Scores

### 4.3.1 Compute Scores

Use regression scoring from the chosen model, to compute latent trait scores
```{r}
fs_reg <- lavPredict(fit_twof_cor_mod, method = "regression")

df$regPressured <- scale(fs_reg[, "Pressured"])
df$regAutonomous <- scale(fs_reg[, "Autonomous"])
```

Also compute Row means for visualizations
```{r}
df$rowmeansAutonomous <- rowMeans(
  df[mmb_autonomous_items],
  na.rm = TRUE
)

df$rowmeansPressured <- rowMeans(
  df[mmb_pressured_items],
  na.rm = TRUE
)
```

Decide which computation to use for later analysis
```{r}
df$pressuredMotivation = df$regPressured
df$autonomousMotivation = df$regAutonomous
```

### 4.3.2 Visualization & Descriptives
```{r}
summary_mean_sd(df, c("rowmeansAutonomous", "rowmeansPressured", "regAutonomous", "regPressured"))
```

```{r}
rm_aut_hist <- plotHist("rowmeansAutonomous", c(0, 7))
rm_pres_hist <- plotHist("rowmeansPressured", c(0, 7))
reg_aut_hist <- plotHist("regAutonomous", c(-5, 5))
reg_pres_hist <- plotHist("regPressured", c(-5, 5))

grid.arrange(rm_aut_hist, rm_pres_hist, reg_aut_hist, reg_pres_hist, ncol = 2)
```

-> regression scoring reduces measurement error at the price of losing variance

```{r}
rm_box <- plotBox(c("rowmeansAutonomous", "rowmeansPressured"))
reg_box <- plotBox(c("regAutonomous", "regPressured"))

grid.arrange(ggpar(rm_box, ylim = c(0, 7)), ggpar(reg_box, ylim = c(-5, 5)), ncol = 2)
```

```{r}
cor(df$regAutonomous, df$regPressured)
cor(df$rowmeansAutonomous, df$rowmeansPressured)
```

**Interpretation**

- moderate to high correlation between pressured and autonomous factor
- the correlation increases with the regression scores (because factors are modeled as correlative) 


# 5. Test Quality Criteria: Aggressive Cognition
*Objectives:*

- Assess the *validity* and *reliability* of the scale for aggressive cognition
- Compute participant latent trait scores

*Methodology:*

- Visualization & Descriptives

## 5.1 Construct Validity

### 5.1.1 Visualization & Descriptives

```{r warning=FALSE}
cor_aggr <- psych::tetrachoric( df[, WFCT_aggression_items])$rho

corrplot::corrplot(cor_aggr,
  method = "color",
  type = "upper",
  order = "original",
  tl.col = "black",
  tl.srt = 45,
  diag = FALSE
)
```
-> a tetrachoric correlation is used, because responses are always binary 
(aggressive, vs. non-aggressive response)

**Interpretation**

- The correlation plot shows no clear pattern between the items
- If all items were to measure the same latent construct (aggressive cognition)
we would expect (somewhat) positive correlations between all the items

```{r}
summary_mean_sd(df, WFCT_aggression_items)
```

**Interpretation**

- *Low Means:* On items 1, 2, 3, 4, 5, 7
- *Missing Values:* 10% missings on items 7, 8, 9, 10

### 5.1.2 Check sampling adequacy for Factor Analysis

```{r}
KMO(cor_aggr)
cortest.bartlett(cor_aggr, n = nrow(df))
```

KMO (Kaiser-Meyer-Olkin) should be > 0.6 (ideally > 0.8)
Bartlett’s test should be significant (p < .05)

**Interpretation**

-  The KMO is extremely low, indicating that the items are not suited for a 
factor analysis
- This is because the items share very little variance (are not correlating)

## 5.2 Reliability
```{r}
psych::alpha(cor_aggr, check.keys = FALSE)
```

**Interpretation**

## 5.3 Latent Trait Scores

### 5.3.1 Compute Scores
```{r}
df$aggressiveWordCompletionScore <- rowMeans(
  replace(df[WFCT_aggression_items], is.na(df[WFCT_aggression_items]), 0)
)
df$aggressiveCognition <-df$aggressiveWordCompletionScore
```

### 5.3.2 Visualization & Descriptives

```{r}
summary_mean_sd(df, "aggressiveCognition")
```

```{r}
plotHist("aggressiveCognition", c(0, 1), condition = NULL, binwidth = 0.1)
```

## Summary
...

# 6. Test Quality Criteria: Anxious Cognition

*Objectives:*

- Assess the *validity* and *reliability* of the scale for anxious cognition
- Compute participant latent trait scores

*Methodology:*

- Descriptives & Visualization

## 6.1 Construct Validity

### 6.1.1 Visualization & Descriptives

```{r}
cor_anx <- psych::tetrachoric(df[, WFCT_anxiety_items])$rho

corrplot::corrplot(cor_anx,
  method = "color",
  type = "upper",
  order = "original",
  tl.col = "black",
  tl.srt = 45,
  diag = FALSE
)
```
-> a tetrachoric correlation is used, because responses are always binary 
(aggressive, vs. non-aggressive)


```{r}
summary_mean_sd(df, WFCT_anxiety_items)
```

**Interpretation**

- *Low Means:* 
- *Missing Values:* ...



**Interpretation**

- ...

### 6.1.2 Check sampling adequacy for Factor Analysis

```{r}
KMO(cor_anx)
cortest.bartlett(cor_anx, n = nrow(df))
```

KMO (Kaiser-Meyer-Olkin) should be > 0.6 (ideally > 0.8)
Bartlett’s test should be significant (p < .05)

**Interpretation**

-  The KMO is extremely low, indicating that the items are not suited for a 
factor analysis
- This is because the items share very little variance ...

## 6.2 Reliability
```{r}
psych::alpha(cor_anx, check.keys = FALSE)
```

## 6.3 Latent Trait Scores

### 6.3.1 Compute Scores
```{r}
df$anxiousWordCompletionScore <- rowMeans(
  replace(df[WFCT_anxiety_items], is.na(df[WFCT_anxiety_items]), 0)
)

df$anxiousWordCompletionScoreTransformed <- asin(sqrt(df$anxiousWordCompletionScore))
```

### 6.3.2 Visualization & Descriptives
```{r}
summary_mean_sd(df, c("anxiousWordCompletionScore"))
```

```{r}
plotHist("anxiousWordCompletionScore", c(0, 1), condition = NULL, binwidth = 0.1)
```

## 6.4 Summary

- lorem ipsum
- dolor sit amet

# 7. Effect of Threat Condition on Aggressive Cognition (Hypothesis 1a)

*Objectives:*

- Assess if there is a statistically significant effect of threat condition on
aggressive cognition

*Methodology:*

- Visualization & Descriptives
- Check assumptions for t-test (normality, homogeneity)
- Since assumptions are violated: Binomial GLM on proportion data

## 7.1 Visualization & Descriptives

```{r}
plotBox("aggressiveCognition", "threatCondition")
```

```{r}
summary_mean_sd(df, "aggressiveCognition", "threatCondition")
```

## 7.2 Check T-Test Assumptions

To ensure independence between value and variance (as pre-registered), we apply an
arcsine square root transformation to the proportion scores before checking assumptions.

```{r}
df$aggressiveWordCompletionScoreTransformed <- asin(sqrt(df$aggressiveWordCompletionScore))
```

### 7.2.1 Normality within each group

```{r}
agg_qq <- check_normality_qq(df, aggressiveWordCompletionScoreTransformed, threatCondition)
agg_hist <- check_normality_hist(df, aggressiveWordCompletionScoreTransformed, threatCondition)
grid.arrange(agg_qq, agg_hist, ncol = 1)
```

**Interpretation:**

- Even after arcsine-sqrt transformation, the distribution shows zero-inflation
  (many participants with 0 aggressive completions)
- Normality assumption is violated, therefore a t-test is not appropriate

### 7.2.2 Homogeneity of Variance

```{r}
check_homogeneity(df, aggressiveWordCompletionScoreTransformed, threatCondition)
```

## 7.3 Inference Statistics: Binomial GLM

Since the outcome is a proportion (number of aggressive completions out of 10 trials)
and assumptions for parametric tests are violated, we use a binomial GLM.

### 7.3.1 Fit Model

```{r}
N_TRIALS_AGGRESSION <- 10

glm_agg <- run_binomial_glm(
  data = df,
  score_col = "aggressiveWordCompletionScore",
  predictor = "threatCondition",
  n_trials = N_TRIALS_AGGRESSION
)

summary(glm_agg$model)
```

### 7.3.2 Model Diagnostics: Residuals

```{r}
check_glm_residual_normality(glm_agg$model)
```

### 7.3.3 Model Diagnostics: Cook's Distance

```{r}
plot(glm_agg$model, which = 4)
```

```{r}
diag_agg <- glm_cooks_diagnostics(glm_agg$model)
print_cooks_summary(diag_agg)
```

### 7.3.4 Sensitivity Analysis: Model without Influential Observations

```{r}
glm_agg_clean <- glm_remove_influential(glm_agg, diag_agg, "threatCondition")
```

```{r}
summary_mean_sd(glm_agg_clean$data_clean, "aggressiveWordCompletionScore", "threatCondition")
```

```{r}
summary(glm_agg_clean$model_clean)
```

### 7.3.5 Results Summary

```{r}
glm_summary_table(
  model = glm_agg$model,
  model_clean = glm_agg_clean$model_clean,
  labels = c(
    "(Intercept)" = "Intercept (No Threat)",
    "threatConditionthreat" = "Threat Condition"
  ),
  one_tailed = c("threatConditionthreat" = "positive")
) %>%
  kbl(caption = "GLM Results: Effect of Threat Condition on Aggressive Cognition") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

*Note on p-value correction:* The hypothesis predicts a directional effect (threat condition increases aggressive cognition). The GLM produces two-tailed p-values by default. For the threat condition coefficient, we apply a one-tailed correction: if the effect is in the expected direction (positive coefficient), p_one-tailed = p_two-tailed / 2; if opposite, p_one-tailed = 1 - (p_two-tailed / 2).

**Interpretation:**

- ...

# 8. Effect of Threat Condition on Anxious Cognition (Hypothesis 1b)

*Objectives:*

- Assess if there is a statistically significant effect of threat condition on
anxious cognition

*Methodology:*

- Visualization & Descriptives
- Check assumptions for t-test (normality, homogeneity)
- Since assumptions are violated: Binomial GLM on proportion data

## 8.1 Visualization & Descriptives

```{r}
plotBox("anxiousWordCompletionScore", "threatCondition")
```

```{r}
summary_mean_sd(df, "anxiousWordCompletionScore", "threatCondition")
```

## 8.2 Check T-Test Assumptions

To ensure independence between value and variance (as pre-registered), we apply an
arcsine square root transformation to the proportion scores before checking assumptions.

```{r}
df$anxiousWordCompletionScoreTransformed <- asin(sqrt(df$anxiousWordCompletionScore))
```

### 8.2.1 Normality within each group

```{r}
anx_qq <- check_normality_qq(df, anxiousWordCompletionScoreTransformed, threatCondition)
anx_hist <- check_normality_hist(df, anxiousWordCompletionScoreTransformed, threatCondition)
grid.arrange(anx_qq, anx_hist, ncol = 1)
```

**Interpretation:**

- Even after arcsine-sqrt transformation, the distribution shows zero-inflation
- Normality assumption is violated, therefore a t-test is not appropriate

### 8.2.2 Homogeneity of Variance

```{r}
check_homogeneity(df, anxiousWordCompletionScoreTransformed, threatCondition)
```

## 8.3 Inference Statistics: Binomial GLM

Since the outcome is a proportion (number of anxious completions out of 10 trials)
and assumptions for parametric tests are violated, we use a binomial GLM.

### 8.3.1 Fit Model

```{r}
N_TRIALS_ANXIETY <- 10

glm_anx <- run_binomial_glm(
  data = df,
  score_col = "anxiousWordCompletionScore",
  predictor = "threatCondition",
  n_trials = N_TRIALS_ANXIETY
)

summary(glm_anx$model)
```

### 8.3.2 Model Diagnostics: Residuals

```{r}
check_glm_residual_normality(glm_anx$model)
```


### 8.3.3 Model Diagnostics: Cook's Distance

```{r}
plot(glm_anx$model, which = 4)
```

```{r}
diag_anx <- glm_cooks_diagnostics(glm_anx$model)
print_cooks_summary(diag_anx)
```

### 8.3.4 Sensitivity Analysis: Model without Influential Observations

```{r}
glm_anx_clean <- glm_remove_influential(glm_anx, diag_anx, "threatCondition")
```

```{r}
summary_mean_sd(glm_anx_clean$data_clean, "anxiousWordCompletionScore", "threatCondition")
```

```{r}
summary(glm_anx_clean$model_clean)
```

### 8.3.5 Results Summary

```{r}
glm_summary_table(
  model = glm_anx$model,
  model_clean = glm_anx_clean$model_clean,
  labels = c(
    "(Intercept)" = "Intercept (No Threat)",
    "threatConditionthreat" = "Threat Condition"
  ),
  one_tailed = c("threatConditionthreat" = "positive")
) %>%
  kbl(caption = "GLM Results: Effect of Threat Condition on Anxious Cognition") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

*Note on p-value correction:* The hypothesis predicts a directional effect (threat condition increases anxious cognition). One-tailed p-values are reported for the threat condition coefficient.

**Interpretation:**

- ...

# 9. Moderation: Pressured Motivation on Aggressive Cognition (Hypothesis 2a)

*Objectives:*

- Assess if pressured motivation for masculine behaviour moderates the effect of
threat condition on aggressive cognition

*Methodology:*

- Visualization & Descriptives
- Check assumptions for multiple linear regression
- Since assumptions are violated: Binomial GLM with interaction term

## 9.1 Visualization

```{r}
plotLine("pressuredMotivation", "aggressiveWordCompletionScore",
  condition = "threatCondition", df = df
)
```

## 9.2 Check Linear Regression Assumptions

Using the arcsine-sqrt transformed scores (as pre-registered) to check assumptions.

### 9.2.1 Multicollinearity

```{r}
check_multicollinearity(df, "threatCondition", "pressuredMotivation")
```

**Interpretation:**

- Since threat condition is randomly assigned, we expect no correlation with the moderator

### 9.2.2 Normality of Outcome

```{r}
agg_mod_qq <- check_normality_qq(df, aggressiveWordCompletionScoreTransformed, threatCondition)
agg_mod_hist <- check_normality_hist(df, aggressiveWordCompletionScoreTransformed, threatCondition)
grid.arrange(agg_mod_qq, agg_mod_hist, ncol = 1)
```

**Interpretation:**

- Even after arcsine-sqrt transformation, the outcome shows zero-inflation
- Normality assumption for linear regression is violated
- Therefore we use a binomial GLM with interaction term

## 9.3 Inference Statistics: Binomial GLM with Moderation

We model the interaction between threat condition and pressured motivation to test
whether pressured motivation moderates the effect of threat on aggressive cognition.

### 9.3.1 Fit Model

```{r}
glm_agg_mod <- run_binomial_glm_moderation(
  data = df,
  score_col = "aggressiveWordCompletionScore",
  predictor = "threatCondition",
  moderator = "pressuredMotivation",
  n_trials = N_TRIALS_AGGRESSION
)

summary(glm_agg_mod$model)
```

### 9.3.2 Model Diagnostics: Residuals

```{r}
check_glm_residual_normality(glm_agg_mod$model)
```

### 9.3.3 Model Diagnostics: Cook's Distance

```{r}
plot(glm_agg_mod$model, which = 4)
```

```{r}
diag_agg_mod <- glm_cooks_diagnostics(glm_agg_mod$model)
print_cooks_summary(diag_agg_mod)
```

### 9.3.4 Sensitivity Analysis: Model without Influential Observations

```{r}
glm_agg_mod_clean <- glm_remove_influential_moderation(
  glm_agg_mod, diag_agg_mod,
  "threatCondition", "pressuredMotivation"
)
```

```{r}
summary(glm_agg_mod_clean$model_clean)
```

### 9.3.5 Results Summary

```{r}
glm_summary_table(
  model = glm_agg_mod$model,
  model_clean = glm_agg_mod_clean$model_clean,
  labels = c(
    "(Intercept)" = "Intercept",
    "threatConditionthreat" = "Threat Condition",
    "pressuredMotivation" = "Pressured Motivation",
    "threatConditionthreat:pressuredMotivation" = "Threat x Pressured Motivation"
  ),
  one_tailed = c(
    "threatConditionthreat" = "positive",
    "threatConditionthreat:pressuredMotivation" = "positive"
  )
) %>%
  kbl(caption = "GLM Results: Moderation of Threat Effect by Pressured Motivation on Aggressive Cognition") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

*Note on p-value correction:* The hypothesis predicts that pressured motivation positively moderates the effect of threat on aggressive cognition (i.e., higher pressured motivation strengthens the threat effect). One-tailed p-values are reported for the threat condition and interaction coefficients.

**Interpretation:**

- The interaction term (threatCondition:pressuredMotivation) tests whether pressured
motivation moderates the effect of threat condition on aggressive cognition
- ...

# 10. Moderation: Autonomous Motivation on Anxious Cognition (Hypothesis 2b)

*Objectives:*

- Assess if autonomous motivation for masculine behaviour moderates the effect of
threat condition on anxious cognition

*Methodology:*

- Visualization & Descriptives
- Check assumptions for multiple linear regression
- Since assumptions are violated: Binomial GLM with interaction term

## 10.1 Visualization

```{r}
plotLine("autonomousMotivation", "anxiousWordCompletionScore",
  condition = "threatCondition", df = df
)
```

## 10.2 Check Linear Regression Assumptions

Using the arcsine-sqrt transformed scores (as pre-registered) to check assumptions.

### 10.2.1 Multicollinearity

```{r}
check_multicollinearity(df, "threatCondition", "autonomousMotivation")
```

**Interpretation:**

- Since threat condition is randomly assigned, we expect no correlation with the moderator

### 10.2.2 Normality of Outcome

```{r}
anx_mod_qq <- check_normality_qq(df, anxiousWordCompletionScoreTransformed, threatCondition)
anx_mod_hist <- check_normality_hist(df, anxiousWordCompletionScoreTransformed, threatCondition)
grid.arrange(anx_mod_qq, anx_mod_hist, ncol = 1)
```

**Interpretation:**

- Even after arcsine-sqrt transformation, the outcome shows zero-inflation
- Normality assumption for linear regression is violated
- Therefore we use a binomial GLM with interaction term

## 10.3 Inference Statistics: Binomial GLM with Moderation

We model the interaction between threat condition and autonomous motivation to test
whether autonomous motivation moderates the effect of threat on anxious cognition.

### 10.3.1 Fit Model

```{r}
glm_anx_mod <- run_binomial_glm_moderation(
  data = df,
  score_col = "anxiousWordCompletionScore",
  predictor = "threatCondition",
  moderator = "autonomousMotivation",
  n_trials = N_TRIALS_ANXIETY
)

summary(glm_anx_mod$model)
```

### 10.3.2 Model Diagnostics: Residuals

```{r}
check_glm_residual_normality(glm_anx_mod$model)
```

### 10.3.3 Model Diagnostics: Cook's Distance

```{r}
plot(glm_anx_mod$model, which = 4)
```

```{r}
diag_anx_mod <- glm_cooks_diagnostics(glm_anx_mod$model)
print_cooks_summary(diag_anx_mod)
```

### 10.3.4 Sensitivity Analysis: Model without Influential Observations

```{r}
glm_anx_mod_clean <- glm_remove_influential_moderation(
  glm_anx_mod, diag_anx_mod,
  "threatCondition", "autonomousMotivation"
)
```

```{r}
summary(glm_anx_mod_clean$model_clean)
```

### 10.3.5 Results Summary

```{r}
glm_summary_table(
  model = glm_anx_mod$model,
  model_clean = glm_anx_mod_clean$model_clean,
  labels = c(
    "(Intercept)" = "Intercept",
    "threatConditionthreat" = "Threat Condition",
    "autonomousMotivation" = "Autonomous Motivation",
    "threatConditionthreat:autonomousMotivation" = "Threat x Autonomous Motivation"
  ),
  one_tailed = c(
    "threatConditionthreat" = "positive",
    "threatConditionthreat:autonomousMotivation" = "positive"
  )
) %>%
  kbl(caption = "GLM Results: Moderation of Threat Effect by Autonomous Motivation on Anxious Cognition") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

*Note on p-value correction:* The hypothesis predicts that autonomous motivation positively moderates the effect of threat on anxious cognition (i.e., higher autonomous motivation strengthens the threat effect). One-tailed p-values are reported for the threat condition and interaction coefficients.

**Interpretation:**

- The interaction term (threatCondition:autonomousMotivation) tests whether autonomous
motivation moderates the effect of threat condition on anxious cognition
- ...



# Post Hoc Exploratory Analysis

using GKSELF as a dependent variable, can we check if MMB moderates the impact of threatCondition on GKSELF

```{r}
plotBox("GKSELF", "threatCondition")
```

```{r}
plotLine("pressuredMotivation", "GKSELF",
  condition = "threatCondition", df = df
)
```


```{r}
model_gkself <- lm(GKSELF ~
  threatCondition * rowmeansAutonomous, data = df)

summary(model_gkself)
```

...

## Additional Visualization & Descriptives

Aggressive and anxious word completions by threat condition
```{r}
agg_anx_by_threat_boxplot <- plotBox(
  c("aggressiveWordCompletionScore", "anxiousWordCompletionScore"),
  "threatCondition"
)
agg_anx_by_threat_boxplot
save_plot(agg_anx_by_threat_boxplot, "aggressive-anxious-cognition-by-threat-boxplot")
```

```{r}
  plotBox(
    c("aggressiveWordCompletionScore", "anxiousWordCompletionScore"),
    "threatCondition",
    x_label = "Cognition Type",
    y_label = "Word Completion Score (%)",
    var_labels = c(
      "aggressiveWordCompletionScore" = "Aggressive",
      "anxiousWordCompletionScore" = "Anxious"
    ),
    fill_labels = c(
      "noThreat" = "No Threat",
      "threat" = "Threat"
    ),
    legend_title = "Condition"
  )
```


```{r}
summary_mean_sd(df, c("aggressiveWordCompletionScore", "anxiousWordCompletionScore"), "threatCondition")
```
